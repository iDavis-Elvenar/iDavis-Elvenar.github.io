<!-- HTML -->

<div id="main">

  <div class="container">
    <div class="card-spoiler border-spoiler mb-3">
        <div class="card-header" id="headingOne">
            <h2 class="mb-0">
              <center><button class="btn btn-spoiler btn-smbtn-danger " data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                  <h7>ðŸ”” Feature Introduction ðŸ””</h7>
              </button></center>
            </h2>
            <div id="collapseOne" class="collapse" aria-labelledby="headingOne">
              <div class="card-body">
                Hello! My name is iDavis and for this event I'm trying a brand new feature on my website - the <b>Chests Comparator</b>!<br><br>
                You can see all the available chests (or as they are called this time - hoops <img src="https://i.ibb.co/frWgY04/EL-stranka-scroll-aquatic-chest1.png" width="20px;">) during the <b>Lucky Little Fin</b> event below including all their prices, chances and rewards!
                The values are - as always on my website - automatically generated from the game, so it ensures quick updates if anything in the game gets changed.<br><br>
                At the same time I'm also introducing new sorting feature, which can be used to sort these chests to help
                you find the bests chests for obtaining either Grand Prizes or Daily Prizes of this event!
                The values of chests' rewards work together with the chapter system on this website, so make sure 
                that your selected chapter (in the right top corner) is correct! The rewards in these chests vary from chapter to chapter
                so make sure you set this up in order to see proper rewards for your current ingame progress!<br><br>
                I will keep repeating this feature in future events and it will
                always appear as an additional tab within the left panel of this site (next to Calendar and Quests). I have ideas for
                even more such additional tabs, so stay tuned! :)<br><br>
                For more information about how this feature works, check out my latest video below. If you have any questions, feel free
                to use its comment section and I will be more than happy to answer. :)<br>
              </div>
          </div>
        </div>
    </div>
  </div>

 <!-- <h5 id="header" class="card-title text-center text-title font-weight-bold" style="text-align: left;">..:: Lucky Little Fin ::..<br></h5>
  <img id="event_banner" src="https://i.ibb.co/F33YbJG/EL-akcia-m-j-2022-banner.png" alt="undefined" class="center " style="margin-bottom: 15px; width: 50%;">
 -->
  <h5 id="header" class="card-title text-center text-title font-weight-bold" style="text-align: left;">..:: Hoops Overview ::..<br></h5>
  <img id="event_banner" src="https://i.ibb.co/fqXfxk1/EL-stranka-scroll-aquatic-all-chests.png" alt="undefined" class="center " style="margin-bottom: 15px;">

  <div class="row">
    <div class="col-sm">
        <center><label for="order_chests" id="order_chests" style="margin-bottom: 35px; margin-top: 15px;">Order By:</label>
            <select id="order_chests" class="custom-select" style="width: 50%;" onchange="sort(this.value);">
                <option value="none">Default</option>
                <option value="dp">Best Chests for Daily Prizes</option>
                <option value="gp">Best Chests for Grand Prizes</option>
            </select>
        </center>
    </div>
  </div>

</div>

<!-- JS DATABASE -->

<script>
var currencies = {
    "june_xxii_": {
        "ec": "https://i.ibb.co/W0SsWfj/EL-akcia-j-l-2021-currency1.png",
        "ep": "https://i.ibb.co/DbMvM6K/EL-akcia-j-l-2021-payback.png"
    }
}

var chests = {
    "june_xxii_": [
        {
            "img": "https://i.ibb.co/frWgY04/EL-stranka-scroll-aquatic-chest1.png",
            "ec": 21,
            "ep": 1,
            "chances": [
              {
                "percentage": 5,
                "type": "episodic",
                "subType": "daily_reward_event_chest_scroll_aquatic",
                "amount": "1"
              },
              {
                "percentage": 12,
                "type": "good",
                "subType": "event_currency_1",
                "amount": "30"
              },
              {
                "percentage": 23,
                "type": "runeShard",
                "subType": "random",
                "amount": "1"
              },
              {
                "percentage": 25,
                "type": "item",
                "subType": "INS_RF_CN_5",
                "amount": "1"
              },
              {
                "percentage": 35,
                "type": "flexible_reward",
                "subType": "frog_seeds",
                "amount": "6"
              }
            ],
            "id": "reward_pool_event_chest_a_scroll_aquatic"
          },
          {
            "img": "https://i.ibb.co/2yZV9Wj/EL-stranka-scroll-aquatic-chest2.png",
            "ec": 26,
            "ep": 1,
            "chances": [
              {
                "percentage": 6,
                "type": "episodic",
                "subType": "daily_reward_event_chest_scroll_aquatic",
                "amount": "1"
              },
              {
                "percentage": 16,
                "type": "item",
                "subType": "INS_RF_CN_15",
                "amount": "1"
              },
              {
                "percentage": 22,
                "type": "good",
                "subType": "spell_knowledge_boost_1",
                "amount": "1"
              },
              {
                "percentage": 28,
                "type": "flexible_reward",
                "subType": "frog_barracks_HM",
                "amount": "6"
              },
              {
                "percentage": 28,
                "type": "flexible_reward",
                "subType": "frog_barracks_HR",
                "amount": "6"
              }
            ],
            "id": "reward_pool_event_chest_b_scroll_aquatic"
          },
          {
            "img": "https://i.ibb.co/Wg5MjRV/EL-stranka-scroll-aquatic-chest3.png",
            "ec": 32,
            "ep": 1,
            "chances": [
              {
                "percentage": 11,
                "type": "episodic",
                "subType": "daily_reward_event_chest_scroll_aquatic",
                "amount": "1"
              },
              {
                "percentage": 11,
                "type": "good",
                "subType": "event_currency_1",
                "amount": "40"
              },
              {
                "percentage": 19,
                "type": "item",
                "subType": "INS_KP_AW_5",
                "amount": "1"
              },
              {
                "percentage": 22,
                "type": "good",
                "subType": "knowledge_points",
                "amount": "3"
              },
              {
                "percentage": 37,
                "type": "flexible_reward",
                "subType": "frog_mana",
                "amount": "6"
              }
            ],
            "id": "reward_pool_event_chest_c_scroll_aquatic"
          },
          {
            "img": "https://i.ibb.co/WgLLt35/EL-stranka-scroll-aquatic-chest4.png",
            "ec": 46,
            "ep": 2,
            "chances": [
              {
                "percentage": 8,
                "type": "episodic",
                "subType": "daily_reward_event_chest_scroll_aquatic",
                "amount": "1"
              },
              {
                "percentage": 12,
                "type": "good",
                "subType": "event_currency_1",
                "amount": "50"
              },
              {
                "percentage": 36,
                "type": "item",
                "subType": "INS_KP_AW_3",
                "amount": "1"
              },
              {
                "percentage": 44,
                "type": "good",
                "subType": "knowledge_points",
                "amount": "2"
              }
            ],
            "id": "reward_pool_event_chest_d_scroll_aquatic"
          },
          {
            "img": "https://i.ibb.co/brNyw5S/EL-stranka-scroll-aquatic-chest5.png",
            "ec": 49,
            "ep": 2,
            "chances": [
              {
                "percentage": 13,
                "type": "episodic",
                "subType": "daily_reward_event_chest_scroll_aquatic",
                "amount": "1"
              },
              {
                "percentage": 17,
                "type": "item",
                "subType": "INS_RF_SPL_33",
                "amount": "2"
              },
              {
                "percentage": 23,
                "type": "flexible_reward",
                "subType": "frog_sentient_q_1_plus_1",
                "amount": "9"
              },
              {
                "percentage": 23,
                "type": "flexible_reward",
                "subType": "frog_barracks_HR",
                "amount": "9"
              },
              {
                "percentage": 24,
                "type": "flexible_reward",
                "subType": "frog_barracks_LM",
                "amount": "9"
              }
            ],
            "id": "reward_pool_event_chest_e_scroll_aquatic"
          },
          {
            "img": "https://i.ibb.co/Phn0k6y/EL-stranka-scroll-aquatic-chest6.png",
            "ec": 64,
            "ep": 2,
            "chances": [
              {
                "percentage": 12,
                "type": "episodic",
                "subType": "daily_reward_event_chest_scroll_aquatic",
                "amount": "1"
              },
              {
                "percentage": 13,
                "type": "good",
                "subType": "event_currency_1",
                "amount": "80"
              },
              {
                "percentage": 22,
                "type": "good",
                "subType": "knowledge_points",
                "amount": "11"
              },
              {
                "percentage": 25,
                "type": "good",
                "subType": "spell_good_production_boost_1",
                "amount": "1"
              },
              {
                "percentage": 28,
                "type": "flexible_reward",
                "subType": "frog_barracks_MA",
                "amount": "9"
              }
            ],
            "id": "reward_pool_event_chest_f_scroll_aquatic"
          },
          {
            "img": "https://i.ibb.co/ctJJCXd/EL-stranka-scroll-aquatic-chest7.png",
            "ec": 79,
            "ep": 3,
            "chances": [
              {
                "percentage": 9,
                "type": "good",
                "subType": "event_currency_1",
                "amount": "120"
              },
              {
                "percentage": 15,
                "type": "item",
                "subType": "INS_KP_AW_10",
                "amount": "2"
              },
              {
                "percentage": 19,
                "type": "episodic",
                "subType": "daily_reward_event_chest_scroll_aquatic",
                "amount": "1"
              },
              {
                "percentage": 22,
                "type": "item",
                "subType": "INS_RF_CN_15",
                "amount": "1"
              },
              {
                "percentage": 35,
                "type": "flexible_reward",
                "subType": "frog_standard_q_2_plus_2",
                "amount": "9"
              }
            ],
            "id": "reward_pool_event_chest_g_scroll_aquatic"
          },
          {
            "img": "https://i.ibb.co/KmqZxpL/EL-stranka-scroll-aquatic-chest8.png",
            "ec": 81,
            "ep": 3,
            "chances": [
              {
                "percentage": 6,
                "type": "good",
                "subType": "event_currency_1",
                "amount": "150"
              },
              {
                "percentage": 19,
                "type": "item",
                "subType": "INS_KP_AW_15",
                "amount": "2"
              },
              {
                "percentage": 23,
                "type": "item",
                "subType": "INS_RF_SPL_25",
                "amount": "1"
              },
              {
                "percentage": 24,
                "type": "episodic",
                "subType": "daily_reward_event_chest_scroll_aquatic",
                "amount": "1"
              },
              {
                "percentage": 28,
                "type": "flexible_reward",
                "subType": "frog_barracks_LR",
                "amount": "12"
              }
            ],
            "id": "reward_pool_event_chest_h_scroll_aquatic"
          },
          {
            "img": "https://i.ibb.co/Wn8Q2DC/EL-stranka-scroll-aquatic-chest9.png",
            "ec": 89,
            "ep": 3,
            "chances": [
              {
                "percentage": 6,
                "type": "good",
                "subType": "event_currency_1",
                "amount": "200"
              },
              {
                "percentage": 18,
                "type": "item",
                "subType": "INS_KP_AW_20",
                "amount": "1"
              },
              {
                "percentage": 21,
                "type": "episodic",
                "subType": "daily_reward_event_chest_scroll_aquatic",
                "amount": "1"
              },
              {
                "percentage": 25,
                "type": "good",
                "subType": "knowledge_points",
                "amount": "10"
              },
              {
                "percentage": 30,
                "type": "flexible_reward",
                "subType": "frog_seeds",
                "amount": "12"
              }
            ],
            "id": "reward_pool_event_chest_i_scroll_aquatic"
          },
    ]
}

// JS CODE

generateChests();

if (typeof rewardMultiplicator === "undefined") {
    var rewardMultiplicator = 1;
}

function generateChests() {
    var selectedEvent = getSelectedEvent();
    var chestsData = getChestsData(selectedEvent);
    draw(chestsData);

}

function getChestsData(selectedEvent) {
    return chests[selectedEvent];
}

function draw(chestsData, sort="") {
    if (document.getElementById("div_chests") !== null) {
        document.getElementById("div_chests").remove();
    }
    let divCenter = document.createElement("div");
    divCenter.id = "div_chests";
    divCenter.style.textAlign = "center";
    let divBBTable = document.createElement("div");
    divBBTable.className = "bbTable";

    for (let i = 0; i < chestsData.length; i++) {

      let table = document.createElement("table");
      table.className = "table-primary";
      table.style.width = "100%";
      table.style.marginBottom = "10px";
      let tbody = document.createElement("tbody");
      let maxRewards = Array.from(new Array(chestsData.length),(val,index) => chestsData[index]["chances"].length).reduce(function(a,b) {
          return Math.max(a,b);
      });
      
      for (let r = 1; r <= 3; r++) {

          let tr = document.createElement("tr");

          if (r === 1) {

              let td1 = document.createElement("td");
              td1.rowSpan = "3";
              td1.style.width = "30%";
              let img = document.createElement("img");
              img.src = chestsData[i]["img"];
              td1.appendChild(img);
              tr.appendChild(td1);

              let td2 = document.createElement("td");
              td2.innerHTML = `<i><b>Costs:</b></i> `+chestsData[i]["ec"]+` <img src="`+currencies[getSelectedEvent()]["ec"]+`">`;
              td2.style.width = 70/maxRewards+"%";
              tr.appendChild(td2);

              let td3 = document.createElement("td");
              td3.innerHTML = `<i>Gives:</i> `+chestsData[i]["ep"]+` <img src="`+currencies[getSelectedEvent()]["ep"]+`">`;
              td3.style.width = 70/maxRewards+"%";
              tr.appendChild(td3);

              let td4 = document.createElement("td");
              td4.colSpan = maxRewards-2;
              if (sort === "dp") {
                  td4.innerHTML = `<h7><i>`+(100/chestsData[i]["chances"].filter(chance => chance["subType"].startsWith("daily_reward"))[0]["percentage"]*chestsData[i]["ec"]).toFixed(1)
                  +` <img src='${currencies[getSelectedEvent()]["ec"]}'> per Daily Prize`+`</i></h7>`;
              } else if (sort === "gp") {
                  td4.innerHTML = `<h7><i>`+(20/chestsData[i]["ep"]*chestsData[i]["ec"]).toFixed(1)
                  +` <img src='${currencies[getSelectedEvent()]["ec"]}'> per Grand Prize`+`</i></h7>`;
              }
              tr.appendChild(td4);

          } else if (r === 2) {

              for (let d = 0; d < maxRewards; d++) {
                  
                  let th = document.createElement("th");
                  if (d < chestsData[i]["chances"].length) {
                      th.innerHTML = chestsData[i]["chances"][d]["percentage"]+"%";
                  }
                  th.style.width = 70/maxRewards+"%";
                  tr.appendChild(th);

              }

          } else {

              for (let d = 0; d < maxRewards; d++) {

                  let td = document.createElement("td");
                  if (d < chestsData[i]["chances"].length) {
                      let reward = getReward(chestsData, i, d);
                      td.innerHTML = (rewardMultiplicator*getAmount(chestsData, i, d))+"x "+reward;
                  }
                  rewardMultiplicator = 1;
                  td.style.width = 70/maxRewards+"%";
                  tr.appendChild(td);
              }

          }

          tbody.appendChild(tr);
      }

      table.appendChild(tbody);
      divBBTable.appendChild(table);
    }
    divCenter.appendChild(divBBTable);
    document.getElementById("column_with_tables").appendChild(divCenter);
}

function getAmount(chestsData, chest, chance) {
    return chestsData[chest]["chances"][chance]["amount"];
}

function getReward(chestsData, chest, chance) {
    if (chestsData[chest]["chances"][chance]["subType"].startsWith("daily_reward")) {
        return goods_icons["daily_reward"];
    }
    if (chestsData[chest]["chances"][chance]["subType"] === "event_currency_1") {
        return `<img src="`+currencies[getSelectedEvent()]["ec"]+`">`;
    }
    if (chestsData[chest]["chances"][chance]["type"] === "runeShard") {
        return goods_icons["rune_shard"];
    }
    if (chestsData[chest]["chances"][chance]["type"] === "item" || chestsData[chest]["chances"][chance]["type"] === "good") {
        if (goods_icons[chestsData[chest]["chances"][chance]["subType"]] !== undefined) {
            return goods_icons[chestsData[chest]["chances"][chance]["subType"]].replaceAll("<br>","");
        } else if (goods_icons[chestsData[chest]["chances"][chance]["subType"].toLowerCase()] !== undefined) {
          return goods_icons[chestsData[chest]["chances"][chance]["subType"].toLowerCase()].replaceAll("<br>","");
        } else {
            return "MISSING!!!"
        }
    }
    if (chestsData[chest]["chances"][chance]["type"] === "flexible_reward") {
        for (let fr = 0; fr < flexibleRewards.length; fr++) {
            if (flexibleRewards[fr]["id"] === chestsData[chest]["chances"][chance]["subType"]) {
                rewardMultiplicator = flexibleRewards[fr]["rewards"][localStorage.getItem("chapter")-1]["amount"];
                return goods_icons[flexibleRewards[fr]["rewards"][localStorage.getItem("chapter")-1]["subType"]];
            }
        }
    }
}

function sort(value) {
    var chestsData = getChestsData(getSelectedEvent()).slice();
    if (value === "none") {
        draw(chestsData);
    }
    else if (value === "dp") {
        //SORT BY DAILY PRIZES
        chestsData.sort((a,b) => (100/a["chances"].filter(chance => chance["subType"].startsWith("daily_reward"))[0]["percentage"]*a["ec"] >
        (100/b["chances"].filter(chance => chance["subType"].startsWith("daily_reward"))[0]["percentage"]*b["ec"])) ? 1 : -1);
        draw(chestsData, value);
    } else if (value === "gp") {
        //SORT BY GRAND PRIZES
        chestsData.sort((a,b) => (20/a["ep"]*a["ec"] > 20/b["ep"]*b["ec"]) ? 1 : -1);
        draw(chestsData, value);
    }
}
</script>